(this["webpackJsonplazy-island-planner"]=this["webpackJsonplazy-island-planner"]||[]).push([[0],[function(e){e.exports=JSON.parse('{"squareSize":8,"squarePerBlock":16,"mapPadding":50,"mapXBlock":7,"mapYBlock":6,"colorBg":"rgb(119, 214, 194)","colorGrid":"rgba(255, 255, 255, 0.2)","colorMainGrid":"rgba(255, 255, 255, 0.4)","colorGridMark":"#2f9b8b","sampleStartX":354,"sampleStartY":117,"sampleEndX":953,"sampleEndY":630,"hideDist":500,"strokeColorBilding":"#00baff","strokeColorPlant":"#00ff48"}')},,,,function(e){e.exports=JSON.parse('{"toolData":[{"mode":"draw","image":"icon_draw.svg","tools":[{"tool":"brush-S","image":"icon_brush-S.svg","size":1},{"tool":"brush-M","image":"icon_brush-M.svg","size":2},{"tool":"brush-L","image":"icon_brush-L.svg","size":3}],"colors":[{"colorName":"colorG1","image":"icon_colorG1.jpg","color":["#3c783b","#437c42","#3d783c","#417a40","#458042"]},{"colorName":"colorG2","image":"icon_colorG2.jpg","color":["#42a140","#49a646","#40a03e","#44a63f","#4fa544"]},{"colorName":"colorG3","image":"icon_colorG3.jpg","color":["#5dc549","#5fc647","#5bc746","#6ecd51","#5cc746"]},{"colorName":"colorSand","image":"icon_colorSand.jpg","color":["#f0e8a7","#ece5a2","#ede7a6","#ebe6a1","#eee8b4"]},{"colorName":"colorWater","image":"icon_colorWater.jpg","color":["#78d4c3","#7bd8c3","#7dd9c0","#79d6c1","#76d5c3"]},{"colorName":"colorRock","image":"icon_colorRock.jpg","color":["#6e7484","#818793","#6e7689","#6f7684","#747788"]},{"colorName":"colorCustom","image":"icon_palette.svg","color":["#b0a07c"]}]},{"mode":"build","image":"icon_build.svg","tools":[{"tool":"building","image":"icon_building.svg","color":"#544f40","items":[{"item":"home","image":"icon_home.svg","size":[5,4],"color":"#f784ae"},{"item":"house","image":"icon_house.svg","size":[4,4],"color":"#f8b616"},{"item":"store","image":"icon_store.svg","size":[7,4]},{"item":"apparel","image":"icon_apparel.svg","size":[5,4]},{"item":"museum","image":"icon_museum.svg","size":[7,4]},{"item":"infoCenter","image":"icon_infoCenter.svg","size":[12,10]},{"item":"camp","image":"icon_camp.svg","size":[4,4]},{"item":"airPort","image":"icon_airPort.svg","size":[8,8]}]},{"tool":"bridge","image":"icon_bridge.svg","color":"#847f64","items":[{"item":"b0","image":"icon_b0.svg","size":[4,2]},{"item":"b90","image":"icon_b90.svg","size":[2,4]},{"item":"b45","image":"icon_b45.svg","size":[6,6]},{"item":"b135","image":"icon_b135.svg","size":[6,6]}]},{"tool":"slope","image":"icon_slope.svg","color":"#edda96","items":[{"item":"s0","image":"icon_s0.svg","size":[4,2]},{"item":"s90","image":"icon_s90.svg","size":[2,4]}]}]},{"mode":"plant","image":"icon_plant.svg","tools":[{"tool":"tree","image":"icon_tree.svg","color":"#00b27a","size":[3,3],"items":[{"item":"broadleaf"},{"item":"conifer","color":"#12560c"},{"item":"apple","image":"icon_apple.svg"},{"item":"cherry","image":"icon_cherry.svg"},{"item":"coconut","image":"icon_coconut.svg"},{"item":"orange","image":"icon_orange.svg"},{"item":"pear","image":"icon_pear.svg"},{"item":"peach","image":"icon_peach.svg"},{"item":"bamboo","image":"icon_bamboo.svg","color":"#c7ea7b"}]},{"tool":"flower","image":"icon_flower.svg","color":"#fff","size":[1,1],"items":[{"item":"red"},{"item":"yellow"},{"item":"white"},{"item":"orange"},{"item":"pink"},{"item":"purple"},{"item":"black"}]}]}]}')},,,,,,,function(e,t,a){e.exports=a(20)},,,,,function(e,t){},,function(e,t){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var o=a(6),i=a(7),r=a(3),n=a(10),s=a(9),l=a(2),c=a.n(l),u=a(8),d=a.n(u),m=a(1),h=a.n(m),p=a(0),g=a(4);var v=function(e){var t,a=e.data.mode||e.data.tool||e.data.item||e.data.colorName,o=e.isActive?"active":"";if(t=e.data.colorName?"color ".concat(e.data.colorName," ").concat(o):e.data.item?"item ".concat(e.type," ").concat(e.data.item," ").concat(o):"".concat(e.type," ").concat(o),e.data.image){if("colorCustom"===a)return c.a.createElement("button",{id:a,onClick:e.onClick,className:t},c.a.createElement("label",null,c.a.createElement("input",{type:"color",defaultValue:e.customColor,onChange:e.changeColor}),c.a.createElement("img",{alt:a,src:e.data.image})));if("tree"===e.type){var i={background:e.data.color};return c.a.createElement("button",{id:a,onClick:e.onClick,className:t,style:i},c.a.createElement("img",{alt:a,src:e.data.image}))}return c.a.createElement("button",{id:a,onClick:e.onClick,className:t},c.a.createElement("img",{alt:a,src:e.data.image}))}var r={background:"flower"===e.type?e.data.item:e.data.color};return c.a.createElement("button",{id:a,onClick:e.onClick,className:t},c.a.createElement("div",{className:"colorBlock",style:r}))};var f=function(e){var t=e.toolData.map((function(t,a){return c.a.createElement("li",{key:a},c.a.createElement(v,{data:t,type:"mode",isActive:e.currentMode===t.mode,onClick:e.onClick}))}));return c.a.createElement("ul",null,t)};var b=function(e){var t=e.currentModeData.tools.map((function(t,a){return c.a.createElement("li",{key:a},c.a.createElement(v,{data:t,type:"tool",isActive:e.currentTool===t.tool,onClick:e.onClick}))}));return c.a.createElement("ul",null,t)};var S=function(e){var t,a,o=e.currentTool;"draw"===e.currentMode?(t=e.currentModeData.colors,a="colorName"):(t=e.currentModeData.tools.find((function(t){if(t.tool===e.currentTool)return t})).items,a="item");var i=t.map((function(t,i){return c.a.createElement("li",{key:i},c.a.createElement(v,{data:t,type:o,isActive:t[a]===e.currentItem,onClick:e.onClick,customColor:e.customColor,changeColor:e.changeColor}))}));return c.a.createElement("div",{className:"menuItems"},c.a.createElement("hr",null),c.a.createElement("ul",null,i))},z=(a(19),function(e){Object(n.a)(a,e);var t=Object(s.a)(a);function a(e){var i;return Object(o.a)(this,a),(i=t.call(this,e)).canvas=c.a.createRef(),i.fileInput=c.a.createRef(),i.upLoadImg=i.upLoadImg.bind(Object(r.a)(i)),i.useDefaultMap=i.useDefaultMap.bind(Object(r.a)(i)),i.changeMode=i.changeMode.bind(Object(r.a)(i)),i.changeTool=i.changeTool.bind(Object(r.a)(i)),i.changeItem=i.changeItem.bind(Object(r.a)(i)),i.changeColor=i.changeColor.bind(Object(r.a)(i)),i.state={isImgUploaded:!1,canvasSizeX:p.squareSize*p.squarePerBlock*p.mapXBlock+2*p.mapPadding,canvasSizeY:p.squareSize*p.squarePerBlock*p.mapYBlock+2*p.mapPadding,squareSize:p.squareSize,currentMode:g.toolData[0].mode,currentModeData:g.toolData[0],currentTool:g.toolData[0].tools[0].tool,currentItem:g.toolData[0].colors[0].colorName,customColor:g.toolData[0].colors[g.toolData[0].colors.length-1].color[0]},i}return Object(i.a)(a,[{key:"componentDidUpdate",value:function(e){h.a.project&&("draw"===this.state.currentMode?this.handleDraw():"build"!==this.state.currentMode&&"plant"!==this.state.currentMode||!this.state.currentItem||this.handleBuildAndPlant())}},{key:"selectImg",value:function(e){var t,a=e.target.nextElementSibling,o=a.innerHTML;t=e.target.value.split("\\").pop(),a.innerHTML=t||o}},{key:"upLoadImg",value:function(){var e=this.fileInput.current.files[0],t=new FileReader,a=this;t.addEventListener("load",(function(){a.setState({isImgUploaded:!0}),a.renderMap(t.result)}),!1),e&&t.readAsDataURL(e)}},{key:"useDefaultMap",value:function(){var e=this;fetch("test.jpg").then((function(e){return e.blob()})).then((function(t){var a=new FileReader;a.readAsDataURL(t),a.addEventListener("load",(function(){e.setState({isImgUploaded:!0}),e.renderMap(a.result)}),!1)}))}},{key:"renderMap",value:function(e){var t=this,a=this.canvas.current;a.width=this.state.canvasSizeX,a.height=this.state.canvasSizeY,h.a.setup(a);var o=new h.a.Raster(e),i=new h.a.Layer;i.name="mapLayer",(new h.a.Layer).name="drawLayer",(new h.a.Layer).name="buildLayer",i.activate(),new h.a.Shape.Rectangle({x:0,y:0,width:this.state.canvasSizeX,height:this.state.canvasSizeY}).fillColor=p.colorBg,o.onLoad=function(){i.activate();var e=p.sampleEndX-p.sampleStartX,a=p.sampleEndY-p.sampleStartY,r=o.getSubRaster(new h.a.Rectangle(p.sampleStartX,p.sampleStartY,e,a));o.remove(),r.visible=!1,r.size=new h.a.Size(p.squarePerBlock*p.mapXBlock,p.squarePerBlock*p.mapYBlock);for(var n=0;n<r.height;n++)for(var s=0;s<r.width;s++){var l=r.getPixel(s,n);new h.a.Shape.Rectangle({x:s*t.state.squareSize+p.mapPadding,y:n*t.state.squareSize+p.mapPadding,width:t.state.squareSize,height:t.state.squareSize}).fillColor=l}},this.renderGrid(),this.componentDidUpdate()}},{key:"renderGrid",value:function(){var e,t=new h.a.Layer;t.name="gridLayer",t.activate();for(var a=[this.state.squareSize+5,this.state.squareSize-2],o=0;o<=p.squarePerBlock*p.mapXBlock;o++)o%p.squarePerBlock===0?((e=new h.a.Path.Line(new h.a.Point(o*this.state.squareSize+p.mapPadding-.5,0),new h.a.Point(o*this.state.squareSize+p.mapPadding-.5,this.state.canvasSizeY))).strokeWidth=3,e.dashArray=a,e.strokeColor=p.colorMainGrid):(e=new h.a.Path.Line(new h.a.Point(o*this.state.squareSize+p.mapPadding-.5,p.mapPadding),new h.a.Point(o*this.state.squareSize+p.mapPadding-.5,this.state.canvasSizeY-p.mapPadding))).strokeColor=p.colorGrid,e.locked=!0;for(var i=0;i<=p.squarePerBlock*p.mapYBlock;i++)i%p.squarePerBlock===0?((e=new h.a.Path.Line(new h.a.Point(0,i*this.state.squareSize+p.mapPadding-.5),new h.a.Point(this.state.canvasSizeX,i*this.state.squareSize+p.mapPadding-.5))).strokeWidth=3,e.dashArray=a,e.strokeColor=p.colorMainGrid):(e=new h.a.Path.Line(new h.a.Point(p.mapPadding,i*this.state.squareSize+p.mapPadding-.5),new h.a.Point(this.state.canvasSizeX-p.mapPadding,i*this.state.squareSize+p.mapPadding-.5))).strokeColor=p.colorGrid,e.locked=!0;for(var r=0;r<p.mapYBlock;r++){var n=new h.a.PointText(new h.a.Point(p.mapPadding/5,this.state.squareSize*p.squarePerBlock*(r+.5)+p.mapPadding));n.fillColor=p.colorGridMark,n.fontSize=2*this.state.squareSize,n.content=String.fromCharCode(65+r),n.fontWeight="bold"}for(var s=0;s<p.mapXBlock;s++){var l=new h.a.PointText(new h.a.Point(this.state.squareSize*p.squarePerBlock*(s+.5)+p.mapPadding,this.state.squareSize*p.squarePerBlock*p.mapYBlock+1.8*p.mapPadding));l.fillColor=p.colorGridMark,l.fontSize=2*this.state.squareSize,l.content=s+1,l.fontWeight="bold"}}},{key:"changeMode",value:function(e){var t,a=e.target.closest("button").getAttribute("id"),o=g.toolData.find((function(e){if(e.mode===a)return e}));t="draw"===a?o.colors[0].colorName:o.tools[0].items[0].item,this.setState({currentMode:a,currentModeData:o,currentTool:o.tools[0].tool,currentItem:t}),this.clearBrushHover(),this.clearNotBuiltItem()}},{key:"changeTool",value:function(e){var t=e.target.closest("button").getAttribute("id"),a=this.state.currentItem;"draw"!==this.state.currentMode&&(a=this.state.currentModeData.tools.find((function(e){if(e.tool===t)return e})).items[0].item);this.setState({currentTool:t,currentItem:a}),this.clearNotBuiltItem()}},{key:"changeItem",value:function(e){var t=e.target.closest("button").getAttribute("id");this.setState({currentItem:t}),this.clearNotBuiltItem()}},{key:"changeColor",value:function(e){this.setState({customColor:e.target.value})}},{key:"isEditableArea",value:function(e){return e.x>p.mapPadding&&e.x<this.state.squareSize*p.squarePerBlock*p.mapXBlock+p.mapPadding&&e.y>p.mapPadding&&e.y<this.state.squareSize*p.squarePerBlock*p.mapYBlock+p.mapPadding}},{key:"handleDraw",value:function(){var e=this;h.a.project.layers.buildLayer.children.forEach((function(e){e.children.deletBtn.opacity=0})),h.a.project.layers.drawLayer.activate();var t,a,o=new h.a.Tool;o.activate();var i=this.state.currentModeData.tools.find((function(t){if(t.tool===e.state.currentTool)return t}));if(t=i.size?i.size:0,"colorCustom"===this.state.currentItem)a=[this.state.customColor];else{var r=this.state.currentModeData.colors.find((function(t){if(t.colorName===e.state.currentItem)return t}));a=r.color}var n=(t-1)*p.squareSize;if(h.a.project.activeLayer.children.brush){if(h.a.project.activeLayer.children.brush.width/this.state.squareSize!==t){h.a.project.activeLayer.children.brush.remove();var s=new h.a.Shape.Rectangle({x:-1*p.hideDist,y:-1*p.hideDist,width:t*this.state.squareSize,height:t*this.state.squareSize});s.fillColor="rgba(255,255,255,0.1)",s.strokeColor="rgba(255,255,255,0.8)",s.name="brush"}}else{var l=new h.a.Shape.Rectangle({x:-1*p.hideDist,y:-1*p.hideDist,width:t*this.state.squareSize,height:t*this.state.squareSize});l.fillColor="rgba(255,255,255,0.1)",l.strokeColor="rgba(255,255,255,0.8)",l.name="brush"}var c=h.a.project.activeLayer.children.brush;o.onMouseMove=function(a){var o=new h.a.Point;o.x=a.point.x-(a.point.x-p.mapPadding)%e.state.squareSize-n+e.state.squareSize*t/2,o.y=a.point.y-(a.point.y-p.mapPadding)%e.state.squareSize-n+e.state.squareSize*t/2,c.position=o},o.onMouseDown=function(o){e.isEditableArea(o.point)&&e.draw(o,t,n,a)},o.onMouseDrag=function(o){e.isEditableArea(o.point)&&e.draw(o,t,n,a)}}},{key:"draw",value:function(e,t,a,o){h.a.project.layers.drawLayer.activate();var i=new h.a.Point(0,0),r=new h.a.Point(0,0),n=h.a.project.activeLayer.children.brush;i.x=e.point.x-(e.point.x-p.mapPadding)%this.state.squareSize-a,i.y=e.point.y-(e.point.y-p.mapPadding)%this.state.squareSize-a;for(var s=0;s<t;s++)for(var l=0;l<t;l++){var c=new h.a.Shape.Rectangle({x:i.x+s*this.state.squareSize,y:i.y+l*this.state.squareSize,width:this.state.squareSize,height:this.state.squareSize});n.position=[i.x+t*this.state.squareSize/2,i.y+t*this.state.squareSize/2],r.x=i.x+s*this.state.squareSize+this.state.squareSize/2,r.y=i.y+l*this.state.squareSize+this.state.squareSize/2;var u=h.a.project.layers[2].hitTest(r,{fill:!0});u&&"brush"!==u.item.name&&u.item.remove(),c.fillColor=o[Math.floor(Math.random()*o.length)]}}},{key:"handleBuildAndPlant",value:function(){var e=this;h.a.project.layers.buildLayer.activate();var t,a=new h.a.Tool;a.activate();var o,i,r,n=!0,s=!1,l=this.state.currentTool,c=this.state.currentModeData.tools.find((function(e){if(e.tool===l)return e})),u=c.items.find((function(t){if(t.item===e.state.currentItem)return t}));if("build"===this.state.currentMode?(t=u.size,o=new h.a.Shape.Rectangle({x:0,y:0,width:t[0]*this.state.squareSize,height:t[1]*this.state.squareSize}),"b45"!==this.state.currentItem&&"b135"!==this.state.currentItem||(o.size=[2*this.state.squareSize,4*this.state.squareSize],o.rotate(parseInt(this.state.currentItem.replace("b","")))),o.fillColor=u.color?u.color:c.color,o.strokeColor=p.strokeColorBilding,r=new h.a.Group([o])):"plant"===this.state.currentMode&&(t=c.size,i=new h.a.Shape.Rectangle({x:0,y:0,width:t[0]*this.state.squareSize,height:t[1]*this.state.squareSize}),r=new h.a.Group([i]),"tree"===this.state.currentTool?((o=new h.a.Shape.Circle(new h.a.Point(t[0]*this.state.squareSize/2,t[1]*this.state.squareSize/2),t[0]*this.state.squareSize*.7/2)).fillColor=u.color?u.color:c.color,o.strokeColor=p.strokeColorPlant,o.opacity=.5):"flower"===this.state.currentTool&&((o=new h.a.Shape.Circle(new h.a.Point(t[0]*this.state.squareSize/2,t[1]*this.state.squareSize/2),t[0]*this.state.squareSize/2)).fillColor=u.item,o.strokeColor=p.strokeColorPlant),r.addChild(o)),u.image&&"bridge"!==c.tool&&"slope"!==c.tool){var d=new h.a.Raster(u.image),m=this.state.squareSize,g="tree"===l?1:2.8;d.onLoad=function(){d.size=new h.a.Size(d.width*m*g/d.height,m*g),d.position=r.position,d.locked=!0,r.addChild(d)}}var v=new h.a.Shape.Circle({center:[r.bounds.size._width,0],radius:.8*this.state.squareSize});v.fillColor="#555";var f=new h.a.PointText(new h.a.Point(r.bounds.size._width-(1.6*this.state.squareSize-6)/2,(1.6*this.state.squareSize-6)/2));f.fillColor="#eee",f.content="\xd7",f.locked=!0;var b=new h.a.Group([v,f]);b.name="deletBtn",b.opacity=0,b.locked=!0;var S=new h.a.Group([r,b]);S.position=[-1*p.hideDist,-1*p.hideDist],a.onMouseMove=function(t){n&&(S.position.x=e.getSnapPoint(t.point.x,!0,S),S.position.y=e.getSnapPoint(t.point.y,!1,S))},a.onMouseDown=function(t){if(n)S.position.x=e.getSnapPoint(t.point.x,!0,S),S.position.y=e.getSnapPoint(t.point.y,!1,S),n=!1,S.data.built=!0;else{h.a.project.activeLayer.children.forEach((function(e){e.children.deletBtn.opacity=0}));var a=h.a.project.layers.buildLayer.hitTest(t.point,{fill:!0,tolerance:1});if(!a)return void(s=!1);"deletBtn"!==a.item.parent.name?(S=a.item.parent.parent,s=!0,S.children.deletBtn.opacity=1,S.children.deletBtn.locked=!1):a.item.parent.parent.remove()}},a.onMouseDrag=function(t){s&&(S.position.x=e.getSnapPoint(t.point.x,!0,S),S.position.y=e.getSnapPoint(t.point.y,!1,S))},a.onMouseUp=function(t){e.setState({currentItem:null}),document.querySelectorAll("button.item").forEach((function(e){e.blur()}))}}},{key:"getSnapPoint",value:function(e,t,a){return t?e-(e-a.bounds._width/2-p.mapPadding)%this.state.squareSize:e-(e-a.bounds._height/2-p.mapPadding)%this.state.squareSize}},{key:"clearBrushHover",value:function(){h.a.project.layers.drawLayer.children.brush&&h.a.project.layers.drawLayer.children.brush.remove()}},{key:"clearNotBuiltItem",value:function(){var e=h.a.project.layers.buildLayer.children[h.a.project.layers.buildLayer.children.length-1];e&&!e.data.built&&e.remove()}},{key:"render",value:function(){return this.state.isImgUploaded?c.a.createElement("div",{className:"editor"},c.a.createElement("aside",null,c.a.createElement("div",{className:"modes"},c.a.createElement(f,{toolData:g.toolData,currentMode:this.state.currentMode,onClick:this.changeMode})),c.a.createElement("div",{className:"tools"},c.a.createElement(b,{currentTool:this.state.currentTool,currentModeData:this.state.currentModeData,onClick:this.changeTool}),c.a.createElement(S,{currentMode:this.state.currentMode,currentModeData:this.state.currentModeData,currentTool:this.state.currentTool,currentItem:this.state.currentItem,onClick:this.changeItem,customColor:this.state.customColor,changeColor:this.changeColor}))),c.a.createElement("canvas",{id:"canvas",ref:this.canvas})):c.a.createElement("div",{className:"intro"},c.a.createElement("h1",null,c.a.createElement("div",null,"Lazy Island Planner")),c.a.createElement("p",null,"\u9019\u662f\u4e00\u500b\u7d66\u61f6\u4eba\u7528\u7684\u300a\u96c6\u5408\u5566\uff01\u52d5\u7269\u68ee\u53cb\u6703\u300b\u5cf6\u5dbc\u898f\u5283\u5de5\u5177\u3002"),c.a.createElement("p",null,"\u4e0a\u50b3\u4f60\u64f7\u53d6\u7684\u5cf6\u5dbc\u5730\u5716\u756b\u9762\uff08\u5982\u4e0b\u5716\uff09\u5373\u53ef\u958b\u59cb\uff0c\u6216",c.a.createElement("button",{className:"link",onClick:this.useDefaultMap},"\u5148\u7528\u6211\u7684\u5730\u5716\u8a66\u8a66\u770b"),"\u3002"),c.a.createElement("img",{src:"test.jpg",alt:"\u4e0a\u50b3\u5716\u793a\u610f\u5716",className:"island-map"}),c.a.createElement("form",null,c.a.createElement("input",{type:"file",ref:this.fileInput,accept:"image/*",id:"img-input",onChange:this.selectImg}),c.a.createElement("label",{for:"img-input",className:"fake-input"},"\u9078\u64c7\u6a94\u6848"),c.a.createElement("div",{id:"error-message"}),c.a.createElement("button",{type:"button",className:"btn-upload",onClick:this.upLoadImg},"\u4e0a\u50b3")))}}]),a}(c.a.Component));d.a.render(c.a.createElement(z,null),document.getElementById("root"))}],[[11,1,2]]]);
//# sourceMappingURL=main.b63d9a8f.chunk.js.map